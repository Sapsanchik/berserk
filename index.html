<!DOCTYPE html>
<html lang="ru">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Система рейтинга Глико</title>
        <link rel="stylesheet" href="style.css" />
    </head>
    <body>
        <div class="container">
            <header>
                <h1>Система рейтинга Глико</h1>
                <p class="description">
                    Сезонная система рейтинга с турнирной статистикой и наградами за
                    посещение.
                </p>
            </header>

            <div class="two-columns">
                <div class="card">
                    <h2>Добавить игрока</h2>
                    <form id="addPlayerForm">
                        <div class="form-group">
                            <label for="playerName">Имя игрока:</label>
                            <input
                                type="text"
                                id="playerName"
                                placeholder="Введите имя игрока"
                                required
                            />
                        </div>
                        <button type="submit">Добавить игрока</button>
                    </form>

                    <h2 style="margin-top: 20px">Список игроков</h2>
                    <div class="player-list" id="playerList"></div>
                </div>

                <div class="card">
                    <h2>Добавить результаты игр</h2>
                    <div class="info-box">
                        <strong>Турнирные игры:</strong> Игры группируются по дате для
                        подсчета статистики турниров.
                    </div>
                    <form id="gamesForm">
                        <div class="form-group">
                            <label for="gameDate">Дата турнира:</label>
                            <input type="date" id="gameDate" required />
                        </div>

                        <h3>Список игр турнира</h3>
                        <div class="games-container" id="gamesContainer"></div>

                        <div class="batch-actions">
                            <button type="button" id="addGameBtn" class="add-game-btn">
                                + Добавить игру
                            </button>
                            <button type="button" id="addByeGameBtn" class="warning">
                                + Добавить BYE
                            </button>
                            <button type="button" id="clearGamesBtn" class="danger">
                                Очистить все
                            </button>
                        </div>

                        <button type="submit">Сохранить турнир</button>
                    </form>
                </div>
            </div>

            <div class="card">
                <div
                    style="
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                        margin-bottom: 15px;
                    "
                >
                    <h2 style="margin: 0">Рейтинг игроков</h2>
                    <div class="sort-controls">
                        <select id="sortBy">
                            <option value="rating">По рейтингу</option>
                            <option value="games">По количеству игр</option>
                            <option value="tournaments">По количеству турниров</option>
                            <option value="name">По имени</option>
                            <option value="rd">По RD (нестабильности)</option>
                        </select>
                        <select id="sortOrder">
                            <option value="desc">По убыванию</option>
                            <option value="asc">По возрастанию</option>
                        </select>
                    </div>
                </div>
                <table id="ratingTable">
                    <thead>
                        <tr>
                            <th class="sortable" data-sort="position">#</th>
                            <th class="sortable" data-sort="name">Игрок</th>
                            <th class="sortable" data-sort="rating">Рейтинг</th>
                            <th class="sortable" data-sort="rd">RD</th>
                            <th class="sortable" data-sort="games">Игр в сезоне</th>
                            <th class="sortable" data-sort="tournaments">Турниров</th>
                            <th class="sortable" data-sort="lastUpdate">
                                Последнее обновление
                            </th>
                        </tr>
                    </thead>
                    <tbody id="ratingBody"></tbody>
                </table>
            </div>

            <div class="card">
                <h2>История игр</h2>
                <div class="game-history">
                    <table id="historyTable">
                        <thead>
                            <tr>
                                <th>Дата</th>
                                <th>Тип</th>
                                <th>Игрок 1</th>
                                <th>Результат</th>
                                <th>Игрок 2</th>
                                <th>Результат</th>
                                <th>Изменения рейтинга</th>
                                <th>Действия</th>
                            </tr>
                        </thead>
                        <tbody id="historyBody"></tbody>
                    </table>
                </div>
            </div>

            <div class="actions">
                <button id="exportData">Экспорт данных</button>
                <button id="importData">Импорт данных</button>
                <button id="resetSeasonBtn" class="warning">Сбросить сезон</button>
                <button id="resetData" class="danger">Сбросить все данные</button>
            </div>
        </div>

        <!-- Модальное окно игрока -->
        <div id="playerModal" class="modal-overlay" style="display: none">
            <div class="player-modal">
                <div class="modal-header">
                    <h2 class="modal-title" id="modalPlayerName">Имя игрока</h2>
                    <button class="close-modal" onclick="closePlayerModal()">×</button>
                </div>

                <div class="tab-navigation">
                    <button class="tab-button active" onclick="switchTab('stats-tab')">
                        Общая статистика
                    </button>
                    <button class="tab-button" onclick="switchTab('tournaments-tab')">
                        Турниры
                    </button>
                    <button class="tab-button" onclick="switchTab('opponents-tab')">
                        Соперники
                    </button>
                </div>

                <div id="stats-tab" class="tab-content active">
                    <div class="player-stats">
                        <div class="stat-card">
                            <div class="stat-value" id="modalPlayerRating">1500</div>
                            <div class="stat-label">Рейтинг</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="modalPlayerRD">200</div>
                            <div class="stat-label">RD</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="modalTotalGames">0</div>
                            <div class="stat-label">Игр в сезоне</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="modalTournamentsCount">0</div>
                            <div class="stat-label">Турниров</div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-value" id="modalAvgGamesPerTournament">
                                0
                            </div>
                            <div class="stat-label">Игр/турнир</div>
                        </div>
                    </div>

                    <!-- Круговая диаграмма будет вставлена здесь автоматически -->

                    <div class="season-reset-section">
                        <h3>Сброс сезонной статистики</h3>
                        <p>
                            Сброс количества игр и турниров для награждения в конце
                            сезона.
                        </p>
                        <div class="reset-stats">
                            <div class="reset-stat">
                                <div class="stat-value" id="resetGamesCount">0</div>
                                <div class="stat-label">Игр в сезоне</div>
                            </div>
                            <div class="reset-stat">
                                <div class="stat-value" id="resetTournamentsCount">0</div>
                                <div class="stat-label">Турниров</div>
                            </div>
                        </div>
                        <button class="warning" onclick="resetPlayerSeason()">
                            Сбросить сезонную статистику
                        </button>
                    </div>
                </div>

                <div id="tournaments-tab" class="tab-content">
                    <h3>История турниров</h3>
                    <div class="tournament-stats" id="tournamentStats">
                        <!-- Статистика по турнирам будет заполнена здесь -->
                    </div>
                </div>

                <div id="opponents-tab" class="tab-content">
                    <h3>Статистика по соперникам</h3>
                    <div class="opponent-stats" id="opponentStats">
                        <!-- Статистика по соперникам будет заполнена здесь -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Модальное окно редактирования игры -->
        <div id="editGameModal" class="modal-overlay" style="display: none">
            <div class="edit-game-modal">
                <div class="modal-header">
                    <h2 class="modal-title">Редактировать игру</h2>
                    <button class="close-modal" onclick="closeEditGameModal()">×</button>
                </div>

                <form id="editGameForm">
                    <input type="hidden" id="editGameIndex" />
                    <div class="form-group">
                        <label for="editGameDate">Дата игры:</label>
                        <input type="date" id="editGameDate" required />
                    </div>

                    <div class="form-group">
                        <label>Игроки и результаты:</label>
                        <div class="form-row">
                            <select id="editPlayer1Select" required>
                                <option value="">Выберите игрока 1</option>
                            </select>
                            <select id="editPlayer1Result" required>
                                <option value="win">Победа</option>
                                <option value="loss">Поражение</option>
                                <option value="draw">Ничья</option>
                            </select>
                        </div>

                        <div class="form-row">
                            <select id="editPlayer2Select" required>
                                <option value="">Выберите игрока 2</option>
                            </select>
                            <select id="editPlayer2Result" required>
                                <option value="win">Победа</option>
                                <option value="loss">Поражение</option>
                                <option value="draw">Ничья</option>
                            </select>
                        </div>
                    </div>

                    <div class="modal-actions">
                        <button
                            type="button"
                            class="secondary"
                            onclick="closeEditGameModal()"
                        >
                            Отмена
                        </button>
                        <button type="submit" class="success">Сохранить изменения</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Модальное окно редактирования игрока -->
        <div id="editPlayerModal" class="modal-overlay" style="display: none">
            <div class="edit-player-modal">
                <div class="modal-header">
                    <h2 class="modal-title">Редактировать игрока</h2>
                    <button class="close-modal" onclick="closeEditPlayerModal()">
                        ×
                    </button>
                </div>

                <form id="editPlayerForm">
                    <input type="hidden" id="editPlayerOriginalName" />
                    <div class="form-group">
                        <label for="editPlayerName">Имя игрока:</label>
                        <input
                            type="text"
                            id="editPlayerName"
                            placeholder="Введите имя игрока"
                            required
                        />
                    </div>

                    <div class="form-group">
                        <label for="editPlayerRating">Рейтинг:</label>
                        <input type="number" id="editPlayerRating" required />
                    </div>

                    <div class="form-group">
                        <label for="editPlayerRD">RD:</label>
                        <input
                            type="number"
                            id="editPlayerRD"
                            required
                            min="30"
                            max="350"
                        />
                    </div>

                    <div class="modal-actions">
                        <button type="button" class="danger" onclick="deletePlayer()">
                            Удалить игрока
                        </button>
                        <button
                            type="button"
                            class="secondary"
                            onclick="closeEditPlayerModal()"
                        >
                            Отмена
                        </button>
                        <button type="submit" class="success">Сохранить изменения</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Модальное окно турнира -->
        <div id="tournamentModal" class="modal-overlay" style="display: none">
            <div class="tournament-modal">
                <div class="modal-header">
                    <h2 class="modal-title" id="tournamentModalTitle">Турнир</h2>
                    <button class="close-modal" onclick="closeTournamentModal()">
                        ×
                    </button>
                </div>

                <div class="tournament-date-edit">
                    <label for="editTournamentDate">Дата турнира:</label>
                    <input type="date" id="editTournamentDate" />
                    <button
                        type="button"
                        class="success"
                        onclick="updateTournamentDate()"
                    >
                        Обновить дату
                    </button>
                </div>

                <h3>Игры турнира</h3>
                <div class="tournament-games-list" id="tournamentGamesList">
                    <!-- Список игр турнира будет заполнен здесь -->
                </div>

                <div class="tournament-batch-actions">
                    <button
                        type="button"
                        class="warning"
                        onclick="recalculateTournament()"
                    >
                        Пересчитать турнир
                    </button>
                    <button type="button" class="danger" onclick="deleteTournament()">
                        Удалить весь турнир
                    </button>
                </div>

                <div class="modal-actions">
                    <button
                        type="button"
                        class="secondary"
                        onclick="closeTournamentModal()"
                    >
                        Закрыть
                    </button>
                </div>
            </div>
        </div>

        <script src="script.js"></script>
    </body>
</html>
