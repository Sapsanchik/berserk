<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–∏—Å—Ç–µ–º–∞ —Ä–µ–π—Ç–∏–Ω–≥–∞ –ì–ª–∏–∫–æ</title>
    <style>
        :root {
            --primary: #3498db;
            --primary-dark: #2980b9;
            --secondary: #2ecc71;
            --danger: #e74c3c;
            --warning: #f39c12;
            --dark: #2c3e50;
            --light: #ecf0f1;
            --gray: #95a5a6;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: var(--dark);
            margin-bottom: 10px;
        }
        
        .description {
            color: var(--gray);
            max-width: 800px;
            margin: 0 auto;
        }
        
        .card {
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 20px;
            margin-bottom: 20px;
        }
        
        h2 {
            color: var(--dark);
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        
        h3 {
            color: var(--dark);
            margin: 15px 0 10px 0;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
        }
        
        input, select, button {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        
        button {
            background-color: var(--primary);
            color: white;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s;
            font-weight: 600;
        }
        
        button:hover {
            background-color: var(--primary-dark);
        }
        
        button.danger {
            background-color: var(--danger);
        }
        
        button.danger:hover {
            background-color: #c0392b;
        }
        
        button.secondary {
            background-color: var(--gray);
        }
        
        button.secondary:hover {
            background-color: #7f8c8d;
        }
        
        button.warning {
            background-color: var(--warning);
        }
        
        button.warning:hover {
            background-color: #e67e22;
        }
        
        button.success {
            background-color: var(--secondary);
        }
        
        button.success:hover {
            background-color: #27ae60;
        }
        
        .two-columns {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        @media (max-width: 768px) {
            .two-columns {
                grid-template-columns: 1fr;
            }
        }
        
        .player-list {
            max-height: 200px;
            overflow-y: auto;
            margin-bottom: 15px;
            border: 1px solid #eee;
            border-radius: 4px;
            padding: 10px;
        }
        
        .player-item {
            display: flex;
            justify-content: space-between;
            padding: 8px;
            border-bottom: 1px solid #f0f0f0;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .player-item:hover {
            background-color: #f8f9fa;
        }
        
        .player-item:last-child {
            border-bottom: none;
        }
        
        .player-actions {
            display: flex;
            gap: 5px;
        }
        
        .player-action-btn {
            padding: 4px 8px;
            font-size: 12px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
        }
        
        .edit-btn {
            background: var(--primary);
            color: white;
        }
        
        .delete-btn {
            background: var(--danger);
            color: white;
        }
        
        .form-row {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
        }
        
        .form-row input, .form-row select {
            flex: 1;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        th {
            background-color: #f8f9fa;
            font-weight: 600;
            color: var(--dark);
        }
        
        tr:hover {
            background-color: #f8f9fa;
        }
        
        .rating {
            font-weight: bold;
        }
        
        .positive {
            color: var(--secondary);
        }
        
        .negative {
            color: var(--danger);
        }
        
        .warning-text {
            color: var(--warning);
        }
        
        .game-history {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .actions button {
            flex: 1;
        }
        
        .rd-value {
            font-size: 0.9em;
            color: var(--gray);
        }
        
        .games-count {
            text-align: center;
            background: #f8f9fa;
            border-radius: 12px;
            padding: 2px 8px;
            font-size: 0.8em;
        }
        
        .rating-change {
            font-size: 0.85em;
            margin-left: 5px;
        }
        
        .info-box {
            background: #e8f4fc;
            border-left: 4px solid var(--primary);
            padding: 10px 15px;
            margin-bottom: 15px;
            border-radius: 4px;
            font-size: 0.9em;
        }
        
        .warning-box {
            background: #fef9e7;
            border-left: 4px solid var(--warning);
            padding: 10px 15px;
            margin-bottom: 15px;
            border-radius: 4px;
            font-size: 0.9em;
        }
        
        .volatility {
            font-size: 0.8em;
            color: var(--gray);
            margin-left: 5px;
        }
        
        .rating-difference {
            font-size: 0.8em;
            color: var(--gray);
            margin-left: 5px;
        }
        
        .expected-result {
            font-size: 0.8em;
            color: var(--primary);
            margin-left: 5px;
        }
        
        .game-entry {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border: 1px solid #e9ecef;
        }
        
        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .game-number {
            font-weight: bold;
            color: var(--dark);
        }
        
        .remove-game {
            background: var(--danger);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 5px 10px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .remove-game:hover {
            background: #c0392b;
        }
        
        .games-container {
            max-height: 500px;
            overflow-y: auto;
            padding: 10px;
            border: 1px solid #eee;
            border-radius: 8px;
            margin-bottom: 15px;
        }
        
        .add-game-btn {
            width: 100%;
            margin-bottom: 10px;
        }
        
        .batch-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .bye-checkbox {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 10px;
        }
        
        .bye-checkbox input {
            width: auto;
        }
        
        .bye-section {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 4px;
            padding: 10px;
            margin-bottom: 10px;
        }
        
        .bye-info {
            font-size: 0.9em;
            color: var(--warning);
            margin-top: 5px;
        }
        
        .game-type-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.7em;
            font-weight: bold;
            margin-left: 8px;
        }
        
        .badge-bye {
            background: var(--warning);
            color: white;
        }
        
        .badge-regular {
            background: var(--primary);
            color: white;
        }
        
        .position-number {
            font-weight: bold;
            color: var(--dark);
            width: 40px;
            text-align: center;
        }
        
        /* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .player-modal, .edit-game-modal, .edit-player-modal {
            background: white;
            border-radius: 10px;
            padding: 30px;
            max-width: 800px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        .edit-game-modal, .edit-player-modal {
            max-width: 500px;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .modal-title {
            color: var(--dark);
            margin: 0;
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--gray);
            padding: 0;
            width: auto;
        }
        
        .close-modal:hover {
            color: var(--danger);
        }
        
        .player-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .stat-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: var(--dark);
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: var(--gray);
            font-size: 0.9em;
        }
        
        .opponent-stats {
            margin-top: 20px;
        }
        
        .opponent-row {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            border-bottom: 1px solid #eee;
            align-items: center;
        }
        
        .opponent-row:hover {
            background: #f8f9fa;
        }
        
        .opponent-name {
            font-weight: 600;
            flex: 1;
        }
        
        .opponent-record {
            display: flex;
            gap: 15px;
        }
        
        .record-item {
            text-align: center;
            min-width: 60px;
        }
        
        .record-value {
            font-weight: bold;
            font-size: 1.1em;
        }
        
        .record-label {
            font-size: 0.8em;
            color: var(--gray);
        }
        
        .win-record { color: var(--secondary); }
        .loss-record { color: var(--danger); }
        .draw-record { color: var(--warning); }
        
        .no-opponents {
            text-align: center;
            color: var(--gray);
            padding: 20px;
            font-style: italic;
        }
        
        .game-actions {
            display: flex;
            gap: 5px;
        }
        
        .game-action-btn {
            padding: 4px 8px;
            font-size: 12px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
        }
        
        .history-actions {
            display: flex;
            gap: 5px;
            justify-content: flex-end;
        }
        
        .modal-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
        }
        
        .modal-actions button {
            width: auto;
            min-width: 100px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>–°–∏—Å—Ç–µ–º–∞ —Ä–µ–π—Ç–∏–Ω–≥–∞ –ì–ª–∏–∫–æ</h1>
            <p class="description">–£–ª—É—á—à–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ä–µ–π—Ç–∏–Ω–≥–∞ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π BYE, —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∏–≥—Ä –∏ –ø—Ä–æ—Ñ–∏–ª–µ–π –∏–≥—Ä–æ–∫–æ–≤.</p>
        </header>
        
        <div class="two-columns">
            <div class="card">
                <h2>–î–æ–±–∞–≤–∏—Ç—å –∏–≥—Ä–æ–∫–∞</h2>
                <form id="addPlayerForm">
                    <div class="form-group">
                        <label for="playerName">–ò–º—è –∏–≥—Ä–æ–∫–∞:</label>
                        <input type="text" id="playerName" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è –∏–≥—Ä–æ–∫–∞" required>
                    </div>
                    <button type="submit">–î–æ–±–∞–≤–∏—Ç—å –∏–≥—Ä–æ–∫–∞</button>
                </form>
                
                <h2 style="margin-top: 20px;">–°–ø–∏—Å–æ–∫ –∏–≥—Ä–æ–∫–æ–≤</h2>
                <div class="player-list" id="playerList">
                    <!-- –°–ø–∏—Å–æ–∫ –∏–≥—Ä–æ–∫–æ–≤ –±—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω —Å–∫—Ä–∏–ø—Ç–æ–º -->
                </div>
            </div>
            
            <div class="card">
                <h2>–î–æ–±–∞–≤–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏–≥—Ä</h2>
                <div class="info-box">
                    <strong>–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∏–≥—Ä—ã + BYE:</strong> –î–æ–±–∞–≤—å—Ç–µ –¥–æ 10 –∏–≥—Ä, –≤–∫–ª—é—á–∞—è BYE (–∫–æ–≥–¥–∞ —É –∏–≥—Ä–æ–∫–∞ –Ω–µ—Ç —Å–æ–ø–µ—Ä–Ω–∏–∫–∞).
                </div>
                <div class="warning-box">
                    <strong>BYE (–∏–≥—Ä–∞ –±–µ–∑ —Å–æ–ø–µ—Ä–Ω–∏–∫–∞):</strong> –ò–≥—Ä–æ–∫ –ø–æ–ª—É—á–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –ø–æ–±–µ–¥—É —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º —Ä–µ–π—Ç–∏–Ω–≥–∞. RD —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è –º–µ–¥–ª–µ–Ω–Ω–µ–µ.
                </div>
                <form id="gamesForm">
                    <div class="form-group">
                        <label for="gameDate">–î–∞—Ç–∞ –∏–≥—Ä:</label>
                        <input type="date" id="gameDate" required>
                    </div>
                    
                    <h3>–°–ø–∏—Å–æ–∫ –∏–≥—Ä</h3>
                    <div class="games-container" id="gamesContainer">
                        <!-- –ò–≥—Ä—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –∑–¥–µ—Å—å -->
                    </div>
                    
                    <div class="batch-actions">
                        <button type="button" id="addGameBtn" class="add-game-btn">+ –î–æ–±–∞–≤–∏—Ç—å –∏–≥—Ä—É</button>
                        <button type="button" id="addByeGameBtn" class="warning">+ –î–æ–±–∞–≤–∏—Ç—å BYE</button>
                        <button type="button" id="clearGamesBtn" class="danger">–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ</button>
                    </div>
                    
                    <button type="submit">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤—Å–µ –∏–≥—Ä—ã</button>
                </form>
            </div>
        </div>
        
        <div class="card">
            <h2>–†–µ–π—Ç–∏–Ω–≥ –∏–≥—Ä–æ–∫–æ–≤</h2>
            <table id="ratingTable">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>–ò–≥—Ä–æ–∫</th>
                        <th>–†–µ–π—Ç–∏–Ω–≥</th>
                        <th>RD</th>
                        <th>–í–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å</th>
                        <th>–ò–≥—Ä —Å—ã–≥—Ä–∞–Ω–æ</th>
                        <th>–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ</th>
                    </tr>
                </thead>
                <tbody id="ratingBody">
                    <!-- –î–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω—ã —Å–∫—Ä–∏–ø—Ç–æ–º -->
                </tbody>
            </table>
        </div>
        
        <div class="card">
            <h2>–ò—Å—Ç–æ—Ä–∏—è –∏–≥—Ä</h2>
            <div class="game-history">
                <table id="historyTable">
                    <thead>
                        <tr>
                            <th>–î–∞—Ç–∞</th>
                            <th>–¢–∏–ø</th>
                            <th>–ò–≥—Ä–æ–∫ 1</th>
                            <th>–†–µ–∑—É–ª—å—Ç–∞—Ç</th>
                            <th>–ò–≥—Ä–æ–∫ 2</th>
                            <th>–†–µ–∑—É–ª—å—Ç–∞—Ç</th>
                            <th>–ò–∑–º–µ–Ω–µ–Ω–∏—è —Ä–µ–π—Ç–∏–Ω–≥–∞</th>
                            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody id="historyBody">
                        <!-- –î–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω—ã —Å–∫—Ä–∏–ø—Ç–æ–º -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <div class="actions">
            <button id="exportData">–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</button>
            <button id="importData">–ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</button>
            <button id="resetData" class="danger">–°–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ</button>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∏–≥—Ä–æ–∫–∞ -->
    <div id="playerModal" class="modal-overlay" style="display: none;">
        <div class="player-modal">
            <div class="modal-header">
                <h2 class="modal-title" id="modalPlayerName">–ò–º—è –∏–≥—Ä–æ–∫–∞</h2>
                <button class="close-modal" onclick="closePlayerModal()">√ó</button>
            </div>
            
            <div class="player-stats">
                <div class="stat-card">
                    <div class="stat-value" id="modalPlayerRating">1500</div>
                    <div class="stat-label">–†–µ–π—Ç–∏–Ω–≥</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="modalPlayerRD">200</div>
                    <div class="stat-label">RD</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="modalTotalGames">0</div>
                    <div class="stat-label">–í—Å–µ–≥–æ –∏–≥—Ä</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="modalWinRate">0%</div>
                    <div class="stat-label">–ü—Ä–æ—Ü–µ–Ω—Ç –ø–æ–±–µ–¥</div>
                </div>
            </div>
            
            <h3>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Å–æ–ø–µ—Ä–Ω–∏–∫–∞–º</h3>
            <div class="opponent-stats" id="opponentStats">
                <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Å–æ–ø–µ—Ä–Ω–∏–∫–∞–º –±—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–∞ –∑–¥–µ—Å—å -->
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏–≥—Ä—ã -->
    <div id="editGameModal" class="modal-overlay" style="display: none;">
        <div class="edit-game-modal">
            <div class="modal-header">
                <h2 class="modal-title">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–≥—Ä—É</h2>
                <button class="close-modal" onclick="closeEditGameModal()">√ó</button>
            </div>
            
            <form id="editGameForm">
                <input type="hidden" id="editGameIndex">
                <div class="form-group">
                    <label for="editGameDate">–î–∞—Ç–∞ –∏–≥—Ä—ã:</label>
                    <input type="date" id="editGameDate" required>
                </div>
                
                <div class="form-group">
                    <label>–ò–≥—Ä–æ–∫–∏ –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:</label>
                    <div class="form-row">
                        <select id="editPlayer1Select" required>
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä–æ–∫–∞ 1</option>
                        </select>
                        <select id="editPlayer1Result" required>
                            <option value="win">–ü–æ–±–µ–¥–∞</option>
                            <option value="loss">–ü–æ—Ä–∞–∂–µ–Ω–∏–µ</option>
                            <option value="draw">–ù–∏—á—å—è</option>
                        </select>
                    </div>
                    
                    <div class="form-row">
                        <select id="editPlayer2Select" required>
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä–æ–∫–∞ 2</option>
                        </select>
                        <select id="editPlayer2Result" required>
                            <option value="win">–ü–æ–±–µ–¥–∞</option>
                            <option value="loss">–ü–æ—Ä–∞–∂–µ–Ω–∏–µ</option>
                            <option value="draw">–ù–∏—á—å—è</option>
                        </select>
                    </div>
                </div>
                
                <div class="modal-actions">
                    <button type="button" class="secondary" onclick="closeEditGameModal()">–û—Ç–º–µ–Ω–∞</button>
                    <button type="submit" class="success">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
                </div>
            </form>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏–≥—Ä–æ–∫–∞ -->
    <div id="editPlayerModal" class="modal-overlay" style="display: none;">
        <div class="edit-player-modal">
            <div class="modal-header">
                <h2 class="modal-title">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–≥—Ä–æ–∫–∞</h2>
                <button class="close-modal" onclick="closeEditPlayerModal()">√ó</button>
            </div>
            
            <form id="editPlayerForm">
                <input type="hidden" id="editPlayerOriginalName">
                <div class="form-group">
                    <label for="editPlayerName">–ò–º—è –∏–≥—Ä–æ–∫–∞:</label>
                    <input type="text" id="editPlayerName" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è –∏–≥—Ä–æ–∫–∞" required>
                </div>
                
                <div class="form-group">
                    <label for="editPlayerRating">–†–µ–π—Ç–∏–Ω–≥:</label>
                    <input type="number" id="editPlayerRating" required>
                </div>
                
                <div class="form-group">
                    <label for="editPlayerRD">RD:</label>
                    <input type="number" id="editPlayerRD" required min="30" max="350">
                </div>
                
                <div class="modal-actions">
                    <button type="button" class="danger" onclick="deletePlayer()">–£–¥–∞–ª–∏—Ç—å –∏–≥—Ä–æ–∫–∞</button>
                    <button type="button" class="secondary" onclick="closeEditPlayerModal()">–û—Ç–º–µ–Ω–∞</button>
                    <button type="submit" class="success">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è —Å–∏—Å—Ç–µ–º—ã –ì–ª–∏–∫–æ
        const INITIAL_RATING = 1500;
        const INITIAL_RD = 200;
        const MIN_RD = 30;
        const Q = Math.log(10) / 400;
        const C = 15;
        
        // –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
        function getPlayers() {
            const players = localStorage.getItem('glickoPlayers');
            return players ? JSON.parse(players) : {};
        }

        function getGames() {
            const games = localStorage.getItem('glickoGames');
            return games ? JSON.parse(games) : [];
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
        function savePlayers(players) {
            localStorage.setItem('glickoPlayers', JSON.stringify(players));
        }

        function saveGames(games) {
            localStorage.setItem('glickoGames', JSON.stringify(games));
        }

        // –ü–µ—Ä–µ—Å—á–µ—Ç –≤—Å–µ—Ö —Ä–µ–π—Ç–∏–Ω–≥–æ–≤ —Å –Ω—É–ª—è
        function recalculateAllRatings() {
            const players = getPlayers();
            const games = getGames();
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—Å–µ—Ö –∏–≥—Ä–æ–∫–æ–≤ –∫ –Ω–∞—á–∞–ª—å–Ω—ã–º –∑–Ω–∞—á–µ–Ω–∏—è–º
            Object.keys(players).forEach(playerName => {
                players[playerName] = {
                    rating: INITIAL_RATING,
                    rd: INITIAL_RD,
                    games: 0,
                    volatility: "0.0",
                    lastUpdate: Date.now()
                };
            });
            
            // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –≤—Å–µ –∏–≥—Ä—ã –ø–æ –ø–æ—Ä—è–¥–∫—É
            games.forEach(game => {
                const currentTime = new Date(game.date).getTime();
                
                if (game.type === 'BYE') {
                    // –û–±—Ä–∞–±–æ—Ç–∫–∞ BYE –∏–≥—Ä—ã
                    const player = players[game.player1];
                    if (player) {
                        const updatedPlayer = updateRatingForBye(player, currentTime);
                        players[game.player1] = {
                            ...player,
                            ...updatedPlayer,
                            games: player.games + 1
                        };
                    }
                } else {
                    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ–±—ã—á–Ω–æ–π –∏–≥—Ä—ã
                    const player1 = players[game.player1];
                    const player2 = players[game.player2];
                    
                    if (player1 && player2) {
                        const resultMap = { 'win': 1, 'loss': 0, 'draw': 0.5 };
                        const numResult1 = resultMap[game.result1];
                        const numResult2 = resultMap[game.result2];
                        
                        const updatedPlayer1 = updateRating(player1, player2, numResult1, currentTime);
                        players[game.player1] = {
                            ...player1,
                            ...updatedPlayer1,
                            games: player1.games + 1
                        };
                        
                        const updatedPlayer2 = updateRating(player2, player1, numResult2, currentTime);
                        players[game.player2] = {
                            ...player2,
                            ...updatedPlayer2,
                            games: player2.games + 1
                        };
                    }
                }
            });
            
            savePlayers(players);
            return players;
        }

        // –†–∞—Å—á–µ—Ç g-—Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è RD
        function g(RD) {
            return 1 / Math.sqrt(1 + 3 * Q * Q * RD * RD / (Math.PI * Math.PI));
        }

        // –†–∞—Å—á–µ—Ç –æ–∂–∏–¥–∞–µ–º–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
        function expectedScore(rating, opponentRating, opponentRD) {
            return 1 / (1 + Math.pow(10, -g(opponentRD) * (rating - opponentRating) / 400));
        }

        // –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π —Ä–∞—Å—á–µ—Ç K-—Ñ–∞–∫—Ç–æ—Ä–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–∞–∑–Ω–∏—Ü—ã —Ä–µ–π—Ç–∏–Ω–≥–æ–≤ –∏ RD
        function calculateKFactor(player, opponent, result, expected) {
            let kFactor = 32; // –ë–∞–∑–æ–≤—ã–π K-—Ñ–∞–∫—Ç–æ—Ä
            
            // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º K-—Ñ–∞–∫—Ç–æ—Ä –¥–ª—è –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
            const surprise = Math.abs(result - expected);
            if (surprise > 0.7) {
                kFactor *= 1.5; // –°–∏–ª—å–Ω–æ–µ —É–¥–∏–≤–ª–µ–Ω–∏–µ
            } else if (surprise > 0.4) {
                kFactor *= 1.2; // –°—Ä–µ–¥–Ω–µ–µ —É–¥–∏–≤–ª–µ–Ω–∏–µ
            }
            
            // –£—á–∏—Ç—ã–≤–∞–µ–º RD –∏–≥—Ä–æ–∫–∞ (–º–µ–Ω—å—à–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω—ã—Ö –∏–≥—Ä–æ–∫–æ–≤)
            if (player.rd < 100) {
                kFactor *= 0.7;
            } else if (player.rd < 150) {
                kFactor *= 0.8;
            }
            
            // –£—á–∏—Ç—ã–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—ã–≥—Ä–∞–Ω–Ω—ã—Ö –∏–≥—Ä
            if (player.games > 30) {
                kFactor *= 0.6;
            } else if (player.games > 10) {
                kFactor *= 0.8;
            }
            
            return Math.min(kFactor, 50); // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –ø—Ä–µ–¥–µ–ª
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–µ–π—Ç–∏–Ω–≥–∞ –∏ RD –ø–æ—Å–ª–µ –æ–±—ã—á–Ω–æ–π –∏–≥—Ä—ã
        function updateRating(player, opponent, result, currentTime) {
            // –†–∞—Å—á–µ—Ç –≤—Ä–µ–º–µ–Ω–∏ —Å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (–≤ –¥–Ω—è—Ö)
            const daysSinceLastUpdate = Math.max((currentTime - player.lastUpdate) / (1000 * 60 * 60 * 24), 0);
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ RD —Å —É—á–µ—Ç–æ–º –≤—Ä–µ–º–µ–Ω–∏
            const newRD = Math.min(Math.sqrt(player.rd * player.rd + C * C * daysSinceLastUpdate), INITIAL_RD);
            
            // –†–∞—Å—á–µ—Ç –æ–∂–∏–¥–∞–µ–º–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
            const E = expectedScore(player.rating, opponent.rating, newRD);
            
            // –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π K-—Ñ–∞–∫—Ç–æ—Ä
            const kFactor = calculateKFactor(player, opponent, result, E);
            
            // –†–∞—Å—á–µ—Ç d^2
            const dSquared = 1 / (Q * Q * g(newRD) * g(newRD) * E * (1 - E));
            
            // –†–∞—Å—á–µ—Ç –Ω–æ–≤–æ–≥–æ —Ä–µ–π—Ç–∏–Ω–≥–∞
            const ratingChange = (kFactor * (result - E));
            
            // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–ª—è –æ—á–µ–Ω—å –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
            const limitedRatingChange = Math.max(Math.min(ratingChange, 100), -100);
            
            const newRating = player.rating + limitedRatingChange;
            
            // –†–∞—Å—á–µ—Ç –Ω–æ–≤–æ–≥–æ RD
            const newRDAfterGame = Math.max(Math.sqrt(1 / (1 / (newRD * newRD) + 1 / dSquared)), MIN_RD);
            
            // –†–∞—Å—á–µ—Ç –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏
            const volatility = ((player.rd - newRDAfterGame) / player.rd * 100).toFixed(1);
            
            return {
                rating: Math.round(newRating),
                rd: Math.round(newRDAfterGame),
                ratingChange: Math.round(limitedRatingChange),
                volatility: volatility,
                expectedScore: E,
                kFactor: kFactor,
                lastUpdate: currentTime
            };
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–µ–π—Ç–∏–Ω–≥–∞ –¥–ª—è BYE (–∏–≥—Ä—ã –±–µ–∑ —Å–æ–ø–µ—Ä–Ω–∏–∫–∞)
        function updateRatingForBye(player, currentTime) {
            // –†–∞—Å—á–µ—Ç –≤—Ä–µ–º–µ–Ω–∏ —Å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (–≤ –¥–Ω—è—Ö)
            const daysSinceLastUpdate = Math.max((currentTime - player.lastUpdate) / (1000 * 60 * 60 * 24), 0);
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ RD —Å —É—á–µ—Ç–æ–º –≤—Ä–µ–º–µ–Ω–∏
            const newRD = Math.min(Math.sqrt(player.rd * player.rd + C * C * daysSinceLastUpdate), INITIAL_RD);
            
            // –î–ª—è BYE –∏–≥—Ä–æ–∫ –ø–æ–ª—É—á–∞–µ—Ç –Ω–µ–±–æ–ª—å—à—É—é –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—É—é –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫—É
            // –∏ –º–µ–¥–ª–µ–Ω–Ω–æ–µ —É–º–µ–Ω—å—à–µ–Ω–∏–µ RD
            const ratingChange = 5; // –ù–µ–±–æ–ª—å—à–æ–µ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ
            
            const newRating = player.rating + ratingChange;
            
            // RD —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è –º–µ–¥–ª–µ–Ω–Ω–µ–µ –¥–ª—è BYE
            const newRDAfterGame = Math.max(newRD * 0.95, MIN_RD);
            
            // –†–∞—Å—á–µ—Ç –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏
            const volatility = ((player.rd - newRDAfterGame) / player.rd * 100).toFixed(1);
            
            return {
                rating: Math.round(newRating),
                rd: Math.round(newRDAfterGame),
                ratingChange: ratingChange,
                volatility: volatility,
                expectedScore: 1, // –î–ª—è BYE –æ–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤—Å–µ–≥–¥–∞ 1 (–ø–æ–±–µ–¥–∞)
                kFactor: 10, // –ü–æ–Ω–∏–∂–µ–Ω–Ω—ã–π K-—Ñ–∞–∫—Ç–æ—Ä –¥–ª—è BYE
                lastUpdate: currentTime
            };
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∏–≥—Ä–æ–∫–∞
        function addPlayer(name) {
            const players = getPlayers();
            
            if (players[name]) {
                alert('–ò–≥—Ä–æ–∫ —Å —Ç–∞–∫–∏–º –∏–º–µ–Ω–µ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!');
                return false;
            }
            
            players[name] = {
                rating: INITIAL_RATING,
                rd: INITIAL_RD,
                games: 0,
                volatility: "0.0",
                lastUpdate: Date.now()
            };
            
            savePlayers(players);
            return true;
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–∞ –æ–±—ã—á–Ω–æ–π –∏–≥—Ä—ã
        function createGameEntry(index) {
            const gameEntry = document.createElement('div');
            gameEntry.className = 'game-entry';
            gameEntry.innerHTML = `
                <div class="game-header">
                    <span class="game-number">–ò–≥—Ä–∞ ${index + 1} <span class="game-type-badge badge-regular">–û–ë–´–ß–ù–ê–Ø</span></span>
                    <button type="button" class="remove-game" onclick="removeGame(this)">√ó –£–¥–∞–ª–∏—Ç—å</button>
                </div>
                <div class="form-row">
                    <select class="player1-select" required>
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä–æ–∫–∞ 1</option>
                    </select>
                    <select class="player1-result" required>
                        <option value="win">–ü–æ–±–µ–¥–∞</option>
                        <option value="loss">–ü–æ—Ä–∞–∂–µ–Ω–∏–µ</option>
                        <option value="draw">–ù–∏—á—å—è</option>
                    </select>
                </div>
                <div class="form-row">
                    <select class="player2-select" required>
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä–æ–∫–∞ 2</option>
                    </select>
                    <select class="player2-result" required>
                        <option value="win">–ü–æ–±–µ–¥–∞</option>
                        <option value="loss">–ü–æ—Ä–∞–∂–µ–Ω–∏–µ</option>
                        <option value="draw">–ù–∏—á—å—è</option>
                    </select>
                </div>
            `;
            
            // –ó–∞–ø–æ–ª–Ω—è–µ–º –≤—ã–ø–∞–¥–∞—é—â–∏–µ —Å–ø–∏—Å–∫–∏ –∏–≥—Ä–æ–∫–∞–º–∏
            populateGameSelects(gameEntry);
            
            return gameEntry;
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–∞ BYE –∏–≥—Ä—ã
        function createByeGameEntry(index) {
            const gameEntry = document.createElement('div');
            gameEntry.className = 'game-entry';
            gameEntry.innerHTML = `
                <div class="game-header">
                    <span class="game-number">–ò–≥—Ä–∞ ${index + 1} <span class="game-type-badge badge-bye">BYE</span></span>
                    <button type="button" class="remove-game" onclick="removeGame(this)">√ó –£–¥–∞–ª–∏—Ç—å</button>
                </div>
                <div class="bye-section">
                    <div class="bye-checkbox">
                        <input type="checkbox" class="is-bye-checkbox" checked disabled>
                        <label>–≠—Ç–æ BYE (–∏–≥—Ä–∞ –±–µ–∑ —Å–æ–ø–µ—Ä–Ω–∏–∫–∞)</label>
                    </div>
                    <div class="form-row">
                        <select class="player1-select" required>
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä–æ–∫–∞</option>
                        </select>
                        <select class="player1-result" required disabled>
                            <option value="win" selected>–ü–æ–±–µ–¥–∞ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)</option>
                        </select>
                    </div>
                    <div class="bye-info">
                        –ò–≥—Ä–æ–∫ –ø–æ–ª—É—á–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –ø–æ–±–µ–¥—É —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º —Ä–µ–π—Ç–∏–Ω–≥–∞ (+5 –æ—á–∫–æ–≤)
                    </div>
                </div>
            `;
            
            // –ó–∞–ø–æ–ª–Ω—è–µ–º –≤—ã–ø–∞–¥–∞—é—â–∏–π —Å–ø–∏—Å–æ–∫ –∏–≥—Ä–æ–∫–∞–º–∏
            populateGameSelects(gameEntry);
            
            return gameEntry;
        }

        // –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –≤—ã–ø–∞–¥–∞—é—â–∏—Ö —Å–ø–∏—Å–∫–æ–≤ –≤ —ç–ª–µ–º–µ–Ω—Ç–µ –∏–≥—Ä—ã
        function populateGameSelects(gameElement) {
            const players = getPlayers();
            const player1Select = gameElement.querySelector('.player1-select');
            const player2Select = gameElement.querySelector('.player2-select');
            
            player1Select.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä–æ–∫–∞ 1</option>';
            if (player2Select) {
                player2Select.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä–æ–∫–∞ 2</option>';
            }
            
            Object.keys(players).forEach(name => {
                const option1 = document.createElement('option');
                option1.value = name;
                option1.textContent = name;
                player1Select.appendChild(option1);
                
                if (player2Select) {
                    const option2 = document.createElement('option');
                    option2.value = name;
                    option2.textContent = name;
                    player2Select.appendChild(option2);
                }
            });
        }

        // –£–¥–∞–ª–µ–Ω–∏–µ –∏–≥—Ä—ã
        function removeGame(button) {
            const gameEntry = button.closest('.game-entry');
            gameEntry.remove();
            updateGameNumbers();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω—É–º–µ—Ä–∞—Ü–∏–∏ –∏–≥—Ä
        function updateGameNumbers() {
            const gameEntries = document.querySelectorAll('.game-entry');
            gameEntries.forEach((entry, index) => {
                const gameNumber = entry.querySelector('.game-number');
                const baseText = gameNumber.textContent.split(' ')[0] + ' ' + (index + 1);
                const badge = gameNumber.querySelector('.game-type-badge');
                gameNumber.innerHTML = baseText + (badge ? ' ' + badge.outerHTML : '');
            });
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π –∏–≥—Ä—ã –≤ —Ñ–æ—Ä–º—É
        function addGameToForm(isBye = false) {
            const gamesContainer = document.getElementById('gamesContainer');
            const gameCount = gamesContainer.children.length;
            
            if (gameCount >= 10) {
                alert('–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–≥—Ä - 10');
                return;
            }
            
            const newGame = isBye ? createByeGameEntry(gameCount) : createGameEntry(gameCount);
            gamesContainer.appendChild(newGame);
        }

        // –û—á–∏—Å—Ç–∫–∞ –≤—Å–µ—Ö –∏–≥—Ä
        function clearAllGames() {
            const gamesContainer = document.getElementById('gamesContainer');
            gamesContainer.innerHTML = '';
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –∏–≥—Ä–∞ BYE
        function isByeGame(gameElement) {
            return gameElement.querySelector('.is-bye-checkbox') !== null;
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∏–≥—Ä
        function addGames(date, gamesData) {
            const players = getPlayers();
            const games = getGames();
            const currentTime = new Date(date).getTime();
            
            // –°–æ–∑–¥–∞–µ–º –∫–æ–ø–∏—é –∏–≥—Ä–æ–∫–æ–≤ –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä–∞—Å—á–µ—Ç–æ–≤
            const tempPlayers = JSON.parse(JSON.stringify(players));
            
            // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –≤—Å–µ –∏–≥—Ä—ã
            gamesData.forEach(gameData => {
                const { player1, player2, result1, result2, isBye } = gameData;
                
                if (!tempPlayers[player1]) {
                    alert(`–ò–≥—Ä–æ–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω: ${player1}`);
                    return false;
                }
                
                if (isBye) {
                    // –û–±—Ä–∞–±–æ—Ç–∫–∞ BYE –∏–≥—Ä—ã
                    const updatedPlayer = updateRatingForBye(tempPlayers[player1], currentTime);
                    tempPlayers[player1] = {
                        ...tempPlayers[player1],
                        ...updatedPlayer,
                        games: tempPlayers[player1].games + 1
                    };
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º BYE –∏–≥—Ä—É –≤ –∏—Å—Ç–æ—Ä–∏—é
                    games.unshift({
                        date: date,
                        type: 'BYE',
                        player1: player1,
                        result1: 'win',
                        player2: 'BYE',
                        result2: 'loss',
                        ratingChange1: updatedPlayer.ratingChange,
                        ratingChange2: 0,
                        ratingDiff: 0,
                        expected1: '100.0',
                        expected2: '0.0'
                    });
                } else {
                    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ–±—ã—á–Ω–æ–π –∏–≥—Ä—ã
                    if (!tempPlayers[player2]) {
                        alert(`–ò–≥—Ä–æ–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω: ${player2}`);
                        return false;
                    }
                    
                    const resultMap = { 'win': 1, 'loss': 0, 'draw': 0.5 };
                    const numResult1 = resultMap[result1];
                    const numResult2 = resultMap[result2];
                    
                    const ratingDiff = Math.abs(tempPlayers[player1].rating - tempPlayers[player2].rating);
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–µ–π—Ç–∏–Ω–≥–∏ –≤–æ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
                    const updatedPlayer1 = updateRating(tempPlayers[player1], tempPlayers[player2], numResult1, currentTime);
                    tempPlayers[player1] = {
                        ...tempPlayers[player1],
                        ...updatedPlayer1,
                        games: tempPlayers[player1].games + 1
                    };
                    
                    const updatedPlayer2 = updateRating(tempPlayers[player2], tempPlayers[player1], numResult2, currentTime);
                    tempPlayers[player2] = {
                        ...tempPlayers[player2],
                        ...updatedPlayer2,
                        games: tempPlayers[player2].games + 1
                    };
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º –∏–≥—Ä—É –≤ –∏—Å—Ç–æ—Ä–∏—é
                    games.unshift({
                        date: date,
                        type: '–û–±—ã—á–Ω–∞—è',
                        player1: player1,
                        player2: player2,
                        result1: result1,
                        result2: result2,
                        ratingChange1: updatedPlayer1.ratingChange,
                        ratingChange2: updatedPlayer2.ratingChange,
                        ratingDiff: ratingDiff,
                        expected1: (updatedPlayer1.expectedScore * 100).toFixed(1),
                        expected2: (updatedPlayer2.expectedScore * 100).toFixed(1)
                    });
                }
            });
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
            savePlayers(tempPlayers);
            saveGames(games);
            
            return true;
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∏–≥—Ä–æ–∫–æ–≤
        function displayPlayerList() {
            const players = getPlayers();
            const playerList = document.getElementById('playerList');
            playerList.innerHTML = '';
            
            if (Object.keys(players).length === 0) {
                playerList.innerHTML = '<p>–ù–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö –∏–≥—Ä–æ–∫–æ–≤</p>';
                return;
            }
            
            Object.entries(players).forEach(([name, data]) => {
                const playerItem = document.createElement('div');
                playerItem.className = 'player-item';
                playerItem.innerHTML = `
                    <span onclick="openPlayerModal('${name}')" style="cursor: pointer; flex: 1;">${name}</span>
                    <div class="player-actions">
                        <button class="player-action-btn edit-btn" onclick="openEditPlayerModal('${name}', event)">‚úèÔ∏è</button>
                        <button class="player-action-btn delete-btn" onclick="deletePlayerPrompt('${name}', event)">üóëÔ∏è</button>
                    </div>
                `;
                playerList.appendChild(playerItem);
            });
        }

        // –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –≤—ã–ø–∞–¥–∞—é—â–∏—Ö —Å–ø–∏—Å–∫–æ–≤ –∏–≥—Ä–æ–∫–æ–≤
        function populatePlayerSelects() {
            const players = getPlayers();
            const gameEntries = document.querySelectorAll('.game-entry');
            
            gameEntries.forEach(entry => {
                populateGameSelects(entry);
            });
            
            // –ó–∞–ø–æ–ª–Ω—è–µ–º —Å–ø–∏—Å–∫–∏ –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏–≥—Ä—ã
            const editPlayer1Select = document.getElementById('editPlayer1Select');
            const editPlayer2Select = document.getElementById('editPlayer2Select');
            
            if (editPlayer1Select) {
                editPlayer1Select.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä–æ–∫–∞ 1</option>';
                editPlayer2Select.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä–æ–∫–∞ 2</option>';
                
                Object.keys(players).forEach(name => {
                    const option1 = document.createElement('option');
                    option1.value = name;
                    option1.textContent = name;
                    editPlayer1Select.appendChild(option1);
                    
                    const option2 = document.createElement('option');
                    option2.value = name;
                    option2.textContent = name;
                    editPlayer2Select.appendChild(option2);
                });
            }
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–π—Ç–∏–Ω–≥–∞
        function displayRating() {
            const players = getPlayers();
            const ratingBody = document.getElementById('ratingBody');
            ratingBody.innerHTML = '';
            
            if (Object.keys(players).length === 0) {
                ratingBody.innerHTML = '<tr><td colspan="7" style="text-align: center;">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ —Ä–µ–π—Ç–∏–Ω–≥–µ</td></tr>';
                return;
            }
            
            const sortedPlayers = Object.entries(players)
                .sort((a, b) => b[1].rating - a[1].rating);
            
            sortedPlayers.forEach(([name, data], index) => {
                const row = document.createElement('tr');
                const lastUpdate = new Date(data.lastUpdate).toLocaleDateString('ru-RU');
                
                row.innerHTML = `
                    <td class="position-number">${index + 1}</td>
                    <td><span onclick="openPlayerModal('${name}')" style="cursor: pointer; font-weight: 600;">${name}</span></td>
                    <td class="rating">${data.rating}</td>
                    <td><span class="rd-value">${data.rd}</span></td>
                    <td><span class="volatility">${data.volatility}%</span></td>
                    <td>${data.games}</td>
                    <td>${lastUpdate}</td>
                `;
                ratingBody.appendChild(row);
            });
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –∏–≥—Ä
        function displayHistory() {
            const games = getGames();
            const historyBody = document.getElementById('historyBody');
            historyBody.innerHTML = '';
            
            if (games.length === 0) {
                historyBody.innerHTML = '<tr><td colspan="8" style="text-align: center;">–ù–µ—Ç –∏—Å—Ç–æ—Ä–∏–∏ –∏–≥—Ä</td></tr>';
                return;
            }
            
            games.forEach((game, index) => {
                const row = document.createElement('tr');
                
                const typeClass = game.type === 'BYE' ? 'warning-text' : '';
                const typeBadge = game.type === 'BYE' ? 'badge-bye' : 'badge-regular';
                
                const result1Class = game.result1 === 'win' ? 'positive' : (game.result1 === 'loss' ? 'negative' : '');
                const result2Class = game.result2 === 'win' ? 'positive' : (game.result2 === 'loss' ? 'negative' : '');
                
                const change1 = game.ratingChange1 > 0 ? `+${game.ratingChange1}` : game.ratingChange1;
                const change2 = game.ratingChange2 > 0 ? `+${game.ratingChange2}` : game.ratingChange2;
                const change1Class = game.ratingChange1 > 0 ? 'positive' : (game.ratingChange1 < 0 ? 'negative' : '');
                const change2Class = game.ratingChange2 > 0 ? 'positive' : (game.ratingChange2 < 0 ? 'negative' : '');
                
                row.innerHTML = `
                    <td>${game.date}</td>
                    <td><span class="${typeClass} game-type-badge ${typeBadge}">${game.type}</span></td>
                    <td><span onclick="openPlayerModal('${game.player1}')" style="cursor: pointer;">${game.player1}</span></td>
                    <td class="${result1Class}">${getResultText(game.result1)}</td>
                    <td>${game.player2 ? `<span onclick="openPlayerModal('${game.player2}')" style="cursor: pointer;">${game.player2}</span>` : '-'}</td>
                    <td class="${result2Class}">${getResultText(game.result2)}</td>
                    <td>
                        <span class="${change1Class}">${game.player1}: ${change1}</span>
                        ${game.player2 ? `<br><span class="${change2Class}">${game.player2}: ${change2}</span>` : ''}
                    </td>
                    <td>
                        <div class="history-actions">
                            <button class="game-action-btn edit-btn" onclick="openEditGameModal(${index})">‚úèÔ∏è</button>
                            <button class="game-action-btn delete-btn" onclick="deleteGame(${index})">üóëÔ∏è</button>
                        </div>
                    </td>
                `;
                historyBody.appendChild(row);
            });
        }
        
        function getResultText(result) {
            const resultMap = {
                'win': '–ü–æ–±–µ–¥–∞',
                'loss': '–ü–æ—Ä–∞–∂–µ–Ω–∏–µ',
                'draw': '–ù–∏—á—å—è'
            };
            return resultMap[result] || result;
        }

        // –û—Ç–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –∏–≥—Ä–æ–∫–∞
        function openPlayerModal(playerName) {
            const players = getPlayers();
            const games = getGames();
            const player = players[playerName];
            
            if (!player) return;
            
            // –ó–∞–ø–æ–ª–Ω—è–µ–º –æ—Å–Ω–æ–≤–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
            document.getElementById('modalPlayerName').textContent = playerName;
            document.getElementById('modalPlayerRating').textContent = player.rating;
            document.getElementById('modalPlayerRD').textContent = player.rd;
            document.getElementById('modalTotalGames').textContent = player.games;
            
            // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –∏–≥—Ä–∞–º
            const playerGames = games.filter(game => 
                game.player1 === playerName || game.player2 === playerName
            );
            
            const wins = playerGames.filter(game => {
                if (game.player1 === playerName) return game.result1 === 'win';
                if (game.player2 === playerName) return game.result2 === 'win';
                return false;
            }).length;
            
            const losses = playerGames.filter(game => {
                if (game.player1 === playerName) return game.result1 === 'loss';
                if (game.player2 === playerName) return game.result2 === 'loss';
                return false;
            }).length;
            
            const draws = playerGames.filter(game => {
                if (game.player1 === playerName) return game.result1 === 'draw';
                if (game.player2 === playerName) return game.result2 === 'draw';
                return false;
            }).length;
            
            const winRate = player.games > 0 ? Math.round((wins / player.games) * 100) : 0;
            document.getElementById('modalWinRate').textContent = winRate + '%';
            
            // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ —Å–æ–ø–µ—Ä–Ω–∏–∫–∞–º
            const opponentStats = {};
            
            playerGames.forEach(game => {
                let opponent, result;
                
                if (game.player1 === playerName) {
                    opponent = game.player2;
                    result = game.result1;
                } else {
                    opponent = game.player1;
                    result = game.result2;
                }
                
                if (opponent === 'BYE') return; // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º BYE –∏–≥—Ä—ã
                
                if (!opponentStats[opponent]) {
                    opponentStats[opponent] = { wins: 0, losses: 0, draws: 0 };
                }
                
                if (result === 'win') opponentStats[opponent].wins++;
                else if (result === 'loss') opponentStats[opponent].losses++;
                else if (result === 'draw') opponentStats[opponent].draws++;
            });
            
            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ —Å–æ–ø–µ—Ä–Ω–∏–∫–∞–º
            const opponentStatsContainer = document.getElementById('opponentStats');
            opponentStatsContainer.innerHTML = '';
            
            if (Object.keys(opponentStats).length === 0) {
                opponentStatsContainer.innerHTML = '<div class="no-opponents">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –∏–≥—Ä–∞—Ö —Å –¥—Ä—É–≥–∏–º–∏ –∏–≥—Ä–æ–∫–∞–º–∏</div>';
            } else {
                Object.entries(opponentStats).forEach(([opponent, stats]) => {
                    const totalGames = stats.wins + stats.losses + stats.draws;
                    const row = document.createElement('div');
                    row.className = 'opponent-row';
                    row.innerHTML = `
                        <div class="opponent-name">${opponent}</div>
                        <div class="opponent-record">
                            <div class="record-item">
                                <div class="record-value win-record">${stats.wins}</div>
                                <div class="record-label">–ü–æ–±–µ–¥</div>
                            </div>
                            <div class="record-item">
                                <div class="record-value loss-record">${stats.losses}</div>
                                <div class="record-label">–ü–æ—Ä–∞–∂–µ–Ω–∏–π</div>
                            </div>
                            <div class="record-item">
                                <div class="record-value draw-record">${stats.draws}</div>
                                <div class="record-label">–ù–∏—á—å–∏—Ö</div>
                            </div>
                            <div class="record-item">
                                <div class="record-value">${totalGames}</div>
                                <div class="record-label">–í—Å–µ–≥–æ</div>
                            </div>
                        </div>
                    `;
                    opponentStatsContainer.appendChild(row);
                });
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
            document.getElementById('playerModal').style.display = 'flex';
        }

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –∏–≥—Ä–æ–∫–∞
        function closePlayerModal() {
            document.getElementById('playerModal').style.display = 'none';
        }

        // –û—Ç–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏–≥—Ä—ã
        function openEditGameModal(gameIndex) {
            const games = getGames();
            const game = games[gameIndex];
            
            if (!game) return;
            
            document.getElementById('editGameIndex').value = gameIndex;
            document.getElementById('editGameDate').value = game.date;
            
            const player1Select = document.getElementById('editPlayer1Select');
            const player2Select = document.getElementById('editPlayer2Select');
            const player1Result = document.getElementById('editPlayer1Result');
            const player2Result = document.getElementById('editPlayer2Result');
            
            // –ó–∞–ø–æ–ª–Ω—è–µ–º –∑–Ω–∞—á–µ–Ω–∏—è
            player1Select.value = game.player1;
            player1Result.value = game.result1;
            
            if (game.type === 'BYE') {
                player2Select.value = '';
                player2Result.value = 'loss';
                player2Select.disabled = true;
                player2Result.disabled = true;
            } else {
                player2Select.value = game.player2;
                player2Result.value = game.result2;
                player2Select.disabled = false;
                player2Result.disabled = false;
            }
            
            document.getElementById('editGameModal').style.display = 'flex';
        }

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏–≥—Ä—ã
        function closeEditGameModal() {
            document.getElementById('editGameModal').style.display = 'none';
        }

        // –û—Ç–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏–≥—Ä–æ–∫–∞
        function openEditPlayerModal(playerName, event) {
            if (event) event.stopPropagation();
            
            const players = getPlayers();
            const player = players[playerName];
            
            if (!player) return;
            
            document.getElementById('editPlayerOriginalName').value = playerName;
            document.getElementById('editPlayerName').value = playerName;
            document.getElementById('editPlayerRating').value = player.rating;
            document.getElementById('editPlayerRD').value = player.rd;
            
            document.getElementById('editPlayerModal').style.display = 'flex';
        }

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏–≥—Ä–æ–∫–∞
        function closeEditPlayerModal() {
            document.getElementById('editPlayerModal').style.display = 'none';
        }

        // –£–¥–∞–ª–µ–Ω–∏–µ –∏–≥—Ä—ã
        function deleteGame(gameIndex) {
            if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç—É –∏–≥—Ä—É? –≠—Ç–æ –ø–æ–≤–ª–∏—è–µ—Ç –Ω–∞ —Ä–µ–π—Ç–∏–Ω–≥–∏ –∏–≥—Ä–æ–∫–æ–≤.')) {
                return;
            }
            
            const games = getGames();
            games.splice(gameIndex, 1);
            saveGames(games);
            
            // –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º –≤—Å–µ —Ä–µ–π—Ç–∏–Ω–≥–∏
            recalculateAllRatings();
            
            displayRating();
            displayHistory();
            displayPlayerList();
            
            alert('–ò–≥—Ä–∞ —É–¥–∞–ª–µ–Ω–∞. –í—Å–µ —Ä–µ–π—Ç–∏–Ω–≥–∏ –ø–µ—Ä–µ—Å—á–∏—Ç–∞–Ω—ã.');
        }

        // –ó–∞–ø—Ä–æ—Å –Ω–∞ —É–¥–∞–ª–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–∞
        function deletePlayerPrompt(playerName, event) {
            if (event) event.stopPropagation();
            
            if (!confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –∏–≥—Ä–æ–∫–∞ "${playerName}"? –≠—Ç–æ —Ç–∞–∫–∂–µ —É–¥–∞–ª–∏—Ç –≤—Å–µ –∏–≥—Ä—ã —Å –µ–≥–æ —É—á–∞—Å—Ç–∏–µ–º.`)) {
                return;
            }
            
            deletePlayer(playerName);
        }

        // –£–¥–∞–ª–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–∞
        function deletePlayer(playerName = null) {
            if (!playerName) {
                playerName = document.getElementById('editPlayerOriginalName').value;
            }
            
            const players = getPlayers();
            const games = getGames();
            
            // –£–¥–∞–ª—è–µ–º –∏–≥—Ä–æ–∫–∞
            delete players[playerName];
            
            // –£–¥–∞–ª—è–µ–º –∏–≥—Ä—ã —Å —É—á–∞—Å—Ç–∏–µ–º —ç—Ç–æ–≥–æ –∏–≥—Ä–æ–∫–∞
            const updatedGames = games.filter(game => 
                game.player1 !== playerName && game.player2 !== playerName
            );
            
            savePlayers(players);
            saveGames(updatedGames);
            
            // –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º –≤—Å–µ —Ä–µ–π—Ç–∏–Ω–≥–∏
            recalculateAllRatings();
            
            displayRating();
            displayHistory();
            displayPlayerList();
            closeEditPlayerModal();
            
            alert(`–ò–≥—Ä–æ–∫ "${playerName}" —É–¥–∞–ª–µ–Ω. –í—Å–µ —Ä–µ–π—Ç–∏–Ω–≥–∏ –ø–µ—Ä–µ—Å—á–∏—Ç–∞–Ω—ã.`);
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∏–≥—Ä–æ–∫–∞
        document.getElementById('addPlayerForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const playerName = document.getElementById('playerName').value.trim();
            
            if (!playerName) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∏–º—è –∏–≥—Ä–æ–∫–∞');
                return;
            }
            
            if (addPlayer(playerName)) {
                displayPlayerList();
                populatePlayerSelects();
                displayRating();
                document.getElementById('addPlayerForm').reset();
            }
        });

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –æ–±—ã—á–Ω–æ–π –∏–≥—Ä—ã –≤ —Ñ–æ—Ä–º—É
        document.getElementById('addGameBtn').addEventListener('click', () => addGameToForm(false));

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è BYE –∏–≥—Ä—ã –≤ —Ñ–æ—Ä–º—É
        document.getElementById('addByeGameBtn').addEventListener('click', () => addGameToForm(true));

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—á–∏—Å—Ç–∫–∏ –≤—Å–µ—Ö –∏–≥—Ä
        document.getElementById('clearGamesBtn').addEventListener('click', clearAllGames);

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∏–≥—Ä
        document.getElementById('gamesForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const date = document.getElementById('gameDate').value;
            if (!date) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –¥–∞—Ç—É –∏–≥—Ä');
                return;
            }
            
            const gameEntries = document.querySelectorAll('.game-entry');
            if (gameEntries.length === 0) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –¥–æ–±–∞–≤—å—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω—É –∏–≥—Ä—É');
                return;
            }
            
            const gamesData = [];
            let hasErrors = false;
            
            gameEntries.forEach((entry, index) => {
                const player1Select = entry.querySelector('.player1-select');
                const player2Select = entry.querySelector('.player2-select');
                const player1Result = entry.querySelector('.player1-result');
                
                const player1 = player1Select.value;
                const result1 = player1Result.value;
                
                if (!player1) {
                    alert(`–í –∏–≥—Ä–µ ${index + 1} –Ω–µ –≤—ã–±—Ä–∞–Ω –∏–≥—Ä–æ–∫`);
                    hasErrors = true;
                    return;
                }
                
                if (isByeGame(entry)) {
                    // BYE –∏–≥—Ä–∞
                    gamesData.push({
                        player1,
                        result1: 'win',
                        isBye: true
                    });
                } else {
                    // –û–±—ã—á–Ω–∞—è –∏–≥—Ä–∞
                    const player2 = player2Select.value;
                    const result2 = entry.querySelector('.player2-result').value;
                    
                    if (!player2) {
                        alert(`–í –∏–≥—Ä–µ ${index + 1} –Ω–µ –≤—ã–±—Ä–∞–Ω –≤—Ç–æ—Ä–æ–π –∏–≥—Ä–æ–∫`);
                        hasErrors = true;
                        return;
                    }
                    
                    if (player1 === player2) {
                        alert(`–í –∏–≥—Ä–µ ${index + 1} –≤—ã–±—Ä–∞–Ω –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ –∏–≥—Ä–æ–∫ –¥–≤–∞–∂–¥—ã`);
                        hasErrors = true;
                        return;
                    }
                    
                    if ((result1 === 'win' && result2 === 'win') || 
                        (result1 === 'loss' && result2 === 'loss')) {
                        alert(`–í –∏–≥—Ä–µ ${index + 1} –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã: –æ–±–∞ –∏–≥—Ä–æ–∫–∞ –Ω–µ –º–æ–≥—É—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –ø–æ–±–µ–¥–∏—Ç—å –∏–ª–∏ –ø—Ä–æ–∏–≥—Ä–∞—Ç—å`);
                        hasErrors = true;
                        return;
                    }
                    
                    gamesData.push({
                        player1,
                        player2,
                        result1,
                        result2,
                        isBye: false
                    });
                }
            });
            
            if (hasErrors) return;
            
            if (addGames(date, gamesData)) {
                displayPlayerList();
                displayRating();
                displayHistory();
                clearAllGames();
                alert(`–£—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ ${gamesData.length} –∏–≥—Ä!`);
            }
        });

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏–≥—Ä—ã
        document.getElementById('editGameForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const gameIndex = parseInt(document.getElementById('editGameIndex').value);
            const date = document.getElementById('editGameDate').value;
            const player1 = document.getElementById('editPlayer1Select').value;
            const player2 = document.getElementById('editPlayer2Select').value;
            const result1 = document.getElementById('editPlayer1Result').value;
            const result2 = document.getElementById('editPlayer2Result').value;
            
            if (!date || !player1) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è');
                return;
            }
            
            const games = getGames();
            
            if (player2) {
                // –û–±—ã—á–Ω–∞—è –∏–≥—Ä–∞
                if (player1 === player2) {
                    alert('–ù–µ–ª—å–∑—è –≤—ã–±—Ä–∞—Ç—å –æ–¥–Ω–æ–≥–æ –∏ —Ç–æ–≥–æ –∂–µ –∏–≥—Ä–æ–∫–∞ –¥–≤–∞–∂–¥—ã');
                    return;
                }
                
                if ((result1 === 'win' && result2 === 'win') || 
                    (result1 === 'loss' && result2 === 'loss')) {
                    alert('–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã: –æ–±–∞ –∏–≥—Ä–æ–∫–∞ –Ω–µ –º–æ–≥—É—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –ø–æ–±–µ–¥–∏—Ç—å –∏–ª–∏ –ø—Ä–æ–∏–≥—Ä–∞—Ç—å');
                    return;
                }
                
                games[gameIndex] = {
                    ...games[gameIndex],
                    date: date,
                    type: '–û–±—ã—á–Ω–∞—è',
                    player1: player1,
                    player2: player2,
                    result1: result1,
                    result2: result2
                };
            } else {
                // BYE –∏–≥—Ä–∞
                games[gameIndex] = {
                    ...games[gameIndex],
                    date: date,
                    type: 'BYE',
                    player1: player1,
                    result1: 'win',
                    player2: 'BYE',
                    result2: 'loss'
                };
            }
            
            saveGames(games);
            
            // –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º –≤—Å–µ —Ä–µ–π—Ç–∏–Ω–≥–∏
            recalculateAllRatings();
            
            displayRating();
            displayHistory();
            displayPlayerList();
            closeEditGameModal();
            
            alert('–ò–≥—Ä–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞. –í—Å–µ —Ä–µ–π—Ç–∏–Ω–≥–∏ –ø–µ—Ä–µ—Å—á–∏—Ç–∞–Ω—ã.');
        });

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏–≥—Ä–æ–∫–∞
        document.getElementById('editPlayerForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const originalName = document.getElementById('editPlayerOriginalName').value;
            const newName = document.getElementById('editPlayerName').value.trim();
            const rating = parseInt(document.getElementById('editPlayerRating').value);
            const rd = parseInt(document.getElementById('editPlayerRD').value);
            
            if (!newName) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∏–º—è –∏–≥—Ä–æ–∫–∞');
                return;
            }
            
            if (rd < 30 || rd > 350) {
                alert('RD –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ –æ—Ç 30 –¥–æ 350');
                return;
            }
            
            const players = getPlayers();
            const games = getGames();
            
            // –ï—Å–ª–∏ –∏–º—è –∏–∑–º–µ–Ω–∏–ª–æ—Å—å, –æ–±–Ω–æ–≤–ª—è–µ–º –µ–≥–æ –≤–æ –≤—Å–µ—Ö –∏–≥—Ä–∞—Ö
            if (originalName !== newName) {
                if (players[newName]) {
                    alert('–ò–≥—Ä–æ–∫ —Å —Ç–∞–∫–∏–º –∏–º–µ–Ω–µ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç');
                    return;
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∏–º—è –≤ –∏–≥—Ä–∞—Ö
                games.forEach(game => {
                    if (game.player1 === originalName) game.player1 = newName;
                    if (game.player2 === originalName) game.player2 = newName;
                });
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∏–º—è –≤ —Å–ø–∏—Å–∫–µ –∏–≥—Ä–æ–∫–æ–≤
                players[newName] = players[originalName];
                delete players[originalName];
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–µ–π—Ç–∏–Ω–≥ –∏ RD
            players[newName].rating = rating;
            players[newName].rd = rd;
            
            savePlayers(players);
            saveGames(games);
            
            displayRating();
            displayHistory();
            displayPlayerList();
            closeEditPlayerModal();
            
            alert('–ü—Ä–æ—Ñ–∏–ª—å –∏–≥—Ä–æ–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω');
        });

        // –≠–∫—Å–ø–æ—Ä—Ç, –∏–º–ø–æ—Ä—Ç –∏ —Å–±—Ä–æ—Å –¥–∞–Ω–Ω—ã—Ö
        document.getElementById('exportData').addEventListener('click', function() {
            const players = getPlayers();
            const games = getGames();
            const data = { players, games };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const url = URL.createObjectURL(dataBlob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'glicko_data.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        });

        document.getElementById('importData').addEventListener('click', function() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.addEventListener('change', function() {
                const file = this.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const data = JSON.parse(e.target.result);
                        
                        if (data.players && data.games) {
                            savePlayers(data.players);
                            saveGames(data.games);
                            
                            // –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º –≤—Å–µ —Ä–µ–π—Ç–∏–Ω–≥–∏
                            recalculateAllRatings();
                            
                            displayPlayerList();
                            populatePlayerSelects();
                            displayRating();
                            displayHistory();
                            alert('–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –∏ —Ä–µ–π—Ç–∏–Ω–≥–∏ –ø–µ—Ä–µ—Å—á–∏—Ç–∞–Ω—ã!');
                        } else {
                            alert('–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞');
                        }
                    } catch (error) {
                        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞: ' + error.message);
                    }
                };
                reader.readAsText(file);
            });
            
            input.click();
        });

        document.getElementById('resetData').addEventListener('click', function() {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —Å–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.')) {
                localStorage.removeItem('glickoPlayers');
                localStorage.removeItem('glickoGames');
                displayPlayerList();
                populatePlayerSelects();
                displayRating();
                displayHistory();
                clearAllGames();
                alert('–í—Å–µ –¥–∞–Ω–Ω—ã–µ —Å–±—Ä–æ—à–µ–Ω—ã');
            }
        });

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω –ø–æ –∫–ª–∏–∫—É –Ω–∞ –æ–≤–µ—Ä–ª–µ–π
        document.getElementById('playerModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closePlayerModal();
            }
        });

        document.getElementById('editGameModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeEditGameModal();
            }
        });

        document.getElementById('editPlayerModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeEditPlayerModal();
            }
        });

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('gameDate').value = today;
            
            displayPlayerList();
            populatePlayerSelects();
            displayRating();
            displayHistory();
            
            // –î–æ–±–∞–≤–ª—è–µ–º –ø–µ—Ä–≤—É—é –∏–≥—Ä—É –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            addGameToForm(false);
        });
    </script>
</body>
</html>